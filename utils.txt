utility function fir version 3